 network working group steve crocker ucla request for comments jon postel ucla june john newkirk harvard mike kraley harvard an official protocol proffering i introduction as advertised in new rfc we are submitting the protocol herein for criticism comments etc we intend for this protocol to become the initial official protocol and will therefore be happiest if no serious objections are raised nevertheless we will entertain all manner of criticism until july and such criticism should be published as a nwg rfc or directed to the first author after july a decision will be made whether to adopt this protocol or slight variation or whether to redesign it and resubmit it for criticism only the protocol in preceding discussions of protocol no clear distinction has been made between the network wide specifications and local strategies we state here that the only network wide issues are message formats and restrictions on message content implementation of a network control program ncp and choice of system calls are strictly local issues this document is constrained to cover only network wide issues and thus will not treat system calls or ncp tables nevertheless a protocol is useless without an ncp and a set of system calls so we have expended a great deal of effort in deriving a protypical ncp this effort is reported in nwg rfc and the reader should correlate the protocol presented here with the suggestions for using it presented there it is important to remember however that the content of nwg rfc is only suggestive and that competitive proposals should be examined before choosing an implementation flow control in the course of designing this current protocol we have come to understand that flow control is more complex than we imagined we now believe that flow control techniques will be one of the active areas of concern as the network traffic increases we have therefore benefitted from some ideas stimulated by richard kaline and anatol holt and have modified the flow control procedure defects in our scheme are of course only our fault this new crocker postel newkirk kraley page rfc an official protocol proffering june procedure has demonstrable limitations but has the advantages that it is more cleanly implementable and will support initial network use this is the only substantive change from the protocol already agreed upon the new flow control mechanism requires the receiving host to allocate buffer space for each connection and to notify the sending host of how much space in bits is available the sending host keeps track of how much room is available and never sends more text than it believes the receiving host can accept to implement this mechanism the sending host keeps a counter associated with each connection the counter is initialized to zero increased by control commands sent from the receiving host and decremented by the text length of any message sent over the connection the sending host is prohibited from sending text longer than the value of the counter so the counter never goes below zero ideally the receiving host will allocate some buffer space as soon as the connection is established the amount allocated must never exceed what the receiver can guarantee to accept as text arrives it occupies the allocated buffer space when the receiving process absorbs the waiting text from the buffer the ncp fires back a new allocation of space for that connection the ncp may allocate space even if the receiving process has not absorbed waiting text if it believes that extra buffer space is appropriate similarly the ncp may decide not to reallocate buffer space after the receiving process makes it available the control command which allocates space is all this command is sent only from the receiving host to the sending host this formulation of flow control obviates the rsm and spd commands in nwg rfc and the host to imp message type and imp to host message types and in the current revision of bbn report the obvious limitation in this scheme is that the receiving host is not permitted to depend upon average buffer usage worse case is always assumed if only a few connections are open it is unlikely that there would be much savings however for more than a few connections average buffer usage will be much less than allocated buffer space we have looked at extensions of this protocol which would include adaptive allocation and we believe this to be feasible for the present this limited scheme seems best and we crocker postel newkirk kraley page rfc an official protocol proffering june look forward to discussing more sophisticated schemes later the old scheme of special rfnm s etc also remains under discussion in order to answer questions and discuss details we will hold a pair of network meetings the first will be on june at harvard and the second on july at ucla we request that no more than on programmer per host attend a meeting and that hosts be represented at only one of these meetings two of us j n and s c will be at both meetings to make reservations to attend the harvard meeting contact mrs margi robison or to make reservations to attend the ucla meeting contact mrs benita kirstel ii the protocol the notion of a connection as explained in nwg rfc pervades the protocol a connection is a simplex communication path intended to be between two processes the primary function of the protocol is to provide for establishment of connections regulation of flow over connections and termination of connections in addition the protocol provides some ancillary functions such as sending simulated interrupt pulses and echoing test messages to provide a path for exchanging information about connections we designate specific links i e link one between each pair of hosts to be control links traffic on control links consists only of control commands defined below connections are named by a pair of sockets sockets are bit names which are known throughout the network each host is assigned a private subset of these names and a command which requests a connection names one socket which is local to the requesting host and one local to the receiver of the request sockets are polarized even numbered sockets are receive sockets odd numbered ones are send sockets one of each is required to make a connection crocker postel newkirk kraley page rfc an official protocol proffering june to facilitate transmission of information over a connection a unique link is assigned to each connection one of the steps in establishing a connection therefore is the assignment of a link of the non control links zero is reserved for intra network use and links to are reserved for experiment and expansion thus only links through are available for regular use link assignment must either always be done by the receiver or always by the sender we have almost arbitrarily chosen this to be the receiver s responsibility all regular messages consist of a bit leader marking text and padding marking is a possibly null sequence of zeroes followed by a padding is a followed by a possibly null sequence of zeroes a regular message sent over the control link link is called a control message its text is an integral possibly zero number of control commands in the form described below and this text must end on a command boundary the commands used to establish a connection are str and rts the str command is sent from a prospective sender to a prospective receiver its field contains a send socket local to the prospective sender its field contains a receive socket local to the prospective receiver the rts command is the dual but is also contains a field for link assignment these two commands are referred to as requests for connection rfc a str and an rts match if the field of one is identical to the field of the other and vice versa a connection is established where a matching pair of rfc s have been exchanged hosts are prohibited from establishing more than one connection to any local socket therefore a host may not use a socket for the field of an rfc if that socket is mentioned in a previous rfc and the connection is not yet terminated the command used to terminate a connection is cls each side must send and receive a cls command before a connection is completely terminated and the sockets are free to participate in other connections it is not necessary that both rfc s be exchanged before a connection is terminated more details on termination are given below after a connection is established the receiving host sends a all command which allocates space for the connection the sender keeps track of how much space is available in the receiving host and does not transmit more text than the receiving host can accept as explained above a sender is also constrained by the local imp from sending a message over a connection until the rfnm from the previous crocker postel newkirk kraley page rfc an official protocol proffering june message is received after a connection is established cls commands sent by the receiver and sender have slightly different effects cls command sent by the sender indicate that no more messages will be sent over the connection this command must not be sent if there is a message in transit over the connection cls commands sent by the receiver act as demands on the sender to terminate transmission however since there is a delay in getting the cls command to the sender the receiver must expect its buffers to fill to the limit provided in all commands while a connection is established either side may send inr or ins commands the interpretation of these commands is a local matter but in general they will provide and escape function note that the all inr and ins commands may be sent only after the connection is established and before a cls command is sent a very simple test facility is provided by the eco and erp commands upon receiving a eco command a host must change the first eight bits to erp and return it these commands have no relationship to connections a nop command is included for convenience it is coded as zero to facilitate command message construction finally an err command is included for notifying a foreign host it has apparently made an error at present no specific list of errors is defined and no action is defined for the receipt of err commands hosts should log err commands upon receipt so that system programmers can diagnose the trouble a host may generate an err command at any time and for any reason but it is advised that each host publish an exhaustive list of the err commands it may sent and their interpretations network control commands the following is a detailed description of the structure and format of each of the control commands to facilitate and clarify socket descriptions the following conventions have been adopted and are used in the command descriptions crocker postel newkirk kraley page rfc an official protocol proffering june is local to the originator of the command is local to the receiver of the command control command formats no operation nop request connection receiver to sender rts my socket your socket link request connection sender to receiver str my socket your socket close cls my socket your socket allocate all link space interrupt sent by receiving process inr link crocker postel newkirk kraley page rfc an official protocol proffering june interrupt sent by sending process ins link echo request eco length text echo reply erp length text error detected err length text the host is specified in the leader is bits is bits long and is an unsigned integer is an unsigned bit integer is as long as the length the command is therefore bits longer that the length maximum length is one message to facilitate command decoding and manipulation all control command codes are bit long nop rts str cls all inr crocker postel newkirk kraley page rfc an official protocol proffering june ins eco erp err and are bits long user number aen bits for user number and bits for aen iii conclusion extensions to the protocol some issues have not been adequately treated in the current protocol we have in mind the following topics to consider more thoroughly and perhaps experiment with more sophisticated flow control as mentioned above other schemes for flow control are still being considered other than the necessity of providing some form of it we are completely unsure of the nature of the problem it may turn out that the present scheme is completely adequate it may also turn out that we will need a much more complex scheme error detection and recovery as we gain some experience with the network we will develop a better understanding of what errors can occur and perhaps more importantly what to do about these errors we expect the protocol to change as we understand error control start up and shut down procedures we have not done enough thinking about the problem of the host which participates part time in the network which ceases normal network operation but remains on the network for special purposes or which recovers from a system failure these issues are critical to robust network operation and are possibly our highest priority query and response a host to host status test would be a valuable tool but it is not yet clear what is appropriate to provide crocker postel newkirk kraley page rfc an official protocol proffering june coming onto the network we suggest that hosts come onto the network gingerly first each host should thoroughly exercise connections to itself then it should arrange experiments with some other host who is already functioning finally it may begin to exercise the facilities of other hosts it is not clear at this time which host will be in the best position to help other hosts first but ucla will attempt to serve this function private networking a common ploy is to use the imp to connect several local computers one or more of which is not available to the whole network for example harvard is connecting its pdp to its pdp via an imp lincoln laboratories is connecting its tsp to the and the tx via an imp and ucla is similarly connecting a xds to its sigma in each of these cases the small machine will not initially provide services to the network although there should be no unwanted traffic to any of these extra hosts it is desirable that they conform minimally to the network protocol provided that they never initiate a connection or send out spurious control commands it is sufficient for a host to respond to cls commands with acknowledging cls commands and to respond to eco commands with erp commands acknowledgments the work presented above is only a small portion of the concurrent effort most of the related effort will be reported in immediately forthcoming rfc s a number of people provided extremely valuable aid during the last two weeks we are particularly grateful to professor george mealy of harvard for supporting four of his students to come westward to work on the network to robert uzgalis for facilitating access to ccn at ucla and to the secretarial staff of the computer science division of the university of utah and especially peggy tueller and marcella sanchez for excellent help in preparing these documents this rfc was put into machine readable form for entry into the online rfc archives by eitetsu baumgardner crocker postel newkirk kraley page 