 network working group p deutsch request for comments xerox research center palo alto ca nic july dec pdp imlac communication system this report describes an operational system for communicating textual display information between a main site computer and a remote display processor the main site machine is a dec pdp with the bbn paging hardware henceforth tenex the remote machine is a imlac pds henceforth imlac section briefly describes the imlac hardware configurations section ii describes the display facilities presented to the user section iii describes the system calls jsys calls implemented in the tenex monitor to provide these facilities section iv describes the formats of the messages used for communication between tenex and the imlac section v analyzes the division of responsibility between the two machines hardware configurations the standard imlac is a bit minicomputer with k of microsecond core a cycle stealing display an input keyboard and an asynchronous serial communication interface the display is normally programmed to draw characters using very short vectors the display comes in two major configurations depending on the presence or absence of hardware for drawing long vectors in the sequel specifications depending on the configuration will be flagged lvh or non lvh respectively the i o system normally does not provide for interrupts when characters arrive from the serial interface deutsch page rfc dec pdp imlac communication system july however the imlac is barely able to keep up with the pdp without this feature so we were able to persuade the manufacturer to implement it while no special hardware is required for the software described here the character interrupt and the sri arc mouse and keyset are highly recommended and the software is oriented towards their use ii facilities each display console in the system may be in display mode or teletype simulation mode in display mode the information displayed consists of text strings at arbitrary positions on the display face in teletype simulation mode the display shows the last lines which would appear on a teletype listing a given console may switch between these modes under program control without losing any information regardless of mode each display has a cursor string which follows the position of the available pointing device the implemented system uses a mouse generally but one console uses a tablet the cursor string may be set by a program for example to indicate at what sort of object the user is expected to point in display mode the screen of a given console is allocated to users in rectangular blocks called display areas this allows users to communicate via a single display split into multiple areas when a user program requests a display area he specifies how many text strings he will want to display in it each string has its own x y location character size font italic underline and an arbitrary number of characters each of these components is settable without disturbing the others each string may be manipulated without affecting the others deutsch page rfc dec pdp imlac communication system july iii jsys calls ada assign a display area jsys ada b allocate a display area accepts r upper left y cord upper left x cord max no string r lower right y cord lower right x cord default c size default n inc default font returns unsuccessful r error code successful r da id function this jsys allocates a display area given the coordinates of the diagonal the maximum number of strings to be displayed and the default setting for the character size font and horizontal increment an bit da id is returned which should subsequently be used to refer to this display area dda deallocate a display area jsys dda b deallocate a display area accepts r da id deutsch page rfc dec pdp imlac communication system july returns unsuccessful r error code successful function this jsys deallocates a display area given the associated da id strda string display add delete or change jsys strda b manipulate move write replace delete a string in a display area accepts r string id da id r first byte pointer or or r second byte pointer or r y cord x cord font c size h inc returns unsuccessful r error code successful r string id function this jsys writes a new string replaces deletes or moves optionally replacing an extant string within a display area in addition the font character size and horizontal increment may be specified for the string the string may be specified by two byte pointers or by one byte pointer with the string terminating with a zero character deutsch page rfc dec pdp imlac communication system july if first byte pointer is zero then if a new string is being written then an error code illstr is returned otherwise the string already exists so delete the string from the display area if the first byte pointer is then if a new string is being written then an error code illstr is returned otherwise use the old string if the first character of the string is a zero character the string to be displayed is null but the string is not deleted the coordinates optional unless the string is new or being moved are relative to the upper leftcorner of the display area if the jsys is to effect an extant string a zero coordinate means use the old value for the font c size and h inc fields a field of all one s indicates that the display area default value set in the ada jsys is to be used a means use the value which was previously used for the extant string if the string is new then an bit string identifier is returned scsr set the cursor string jsys scsr b display a string vectors later as the cursor accepts r first byte pointer or or r second byte pointer or deutsch page rfc dec pdp imlac communication system july r font c size h inc no defaults allowed returns unsuccessful r error code successful function this jsys is used to set the cursor string later a set of vectors will be allowed also if the string length is zero or the first byte pointer is nothing will be displayed for the cursor if the first byte pointer is then the old string will be used if a cursor did not previously exist an illcon error return will be executed sdda suppress the display of an area jsys sdda b suppress all display in a display area accepts r da id r or returns unsuccessful r error code successful function the display image is removed from the display area but is not destroyed if r rdda restore the display of an area jsys rdda b restore all display in a display area deutsch page rfc dec pdp imlac communication system july accepts r da id returns unsuccessful r error code successful function the display image is restored in the display area sdda suppress the display of a string jsys ssda b suppress display of a string in a display area accepts r string id da id returns unsuccessful r error code successful function the display image for the given string is suppressed in the display area rdsa restore the display of a string jsys rsda b restore display of a string in a display area accepts r string id da id deutsch page rfc dec pdp imlac communication system july returns unsuccessful r error code successful function the display image for the given string is restored in the display area tsnda teletype simulation on jsys tsnda b turn tty simlaution on accepts none returns always r if was in work station mode otherwise function restores the tty simulation display area and suppresses all others except the cursor turns wsmode work station mode flag off for this console and returns previous value of wsmode tsfda teletype simulation off jsys tsfda b turn tty simulation off accepts none returns always deutsch page rfc dec pdp imlac communication system july function suppresses the display of the tty simulation display area restores the display of all other display areas and sets wsmode on rstda reset display areas jsys rstda b reset display areas accepts none returns always functions deallocates and removes images from all display areas associated with this console except the tty simulation and cursor the display of which is restored iv message formats messages are sequences of bit characters of which contain useful information the higer order b bit should contain even parity on imlac input and is set to even parity on imlac output if the imlac receives an odd parity character it halts at present in the remainder of this document the parity bit will not be discussed a message may be either a character or a command single character messages from the pdp to the imlac represent program output intended for the teletype commands from the pdp represent display information commands from the imlac represent characters or other input information deutsch page rfc dec pdp imlac communication system july every command is prefixed by an internal escape character code b and a character count the escape character will henceforth be referred to as esc is has the same code as the ascii escape character b messages sent from tenex to imlac characters b b are directed to the teletype simulation area character b line feed starts a new line in the teletype simulation area an esc indicates that display or control information is coming as follows every message beginning with esc contains the number of following characters as its second character certain constructs appear in several command messages da a display area identifier is a pair of characters containing bits of information st bits b nd bits b nstrs a string count is a single character between and b strid a string identifier is a single character between and b retain the retention flag if non zero specifies that an existing string should be retained rather than overwritten csize a character size is a single character between and the character sizes are respectively x x x x hinc a horizontal increment is a single character in the present implementation hinc is ignored and a standard spacing is supplied as follows deutsch page rfc dec pdp imlac communication system july lvh units units units units non lvh units units units units fonts a font specification is a single character in the present implementation the font is stored but does not affect the display outxy an output x y coordinate pair is encoded in four characters as follows st x bits b nd x bits b rd y bits b th y bits b inxy an input x y coordinate pair is encoded in four characters as follows lvh see outxy above non lvh as above except that each bit coordinate is actually of the form b b v v mod where the actual coordinate is v this means there are actually fewer points on each axis deutsch page rfc dec pdp imlac communication system july string a string is just the requisite number of characters control characters will be displayed as a distinctive blot each display operation has a corresponding message b ada assign display area followed by da nstrs csize hinc font b dda delete display area followed by da b strda string display followed by da strid retain xy format csize hinc font string format specifies whether each of csize hinc and font is to come from the display area default the current value for the string or the message the bits are stf sti stc rdf rdi rdc rdf means read the font from the message rdf stf means use the old value from the string rdf stf means use the display area default the pairs rdi sti and rdc stc specify hinc and csize in the same way b scsr set cursor string followed by retain csize hinc font string b sdda suppress display of da followed by da kill kill means delete all strings in this display area kill means retain the strings deutsch page rfc dec pdp imlac communication system july b rdda restore display of da followed by da b sdda suppress display of string followed by da strid kill kill means delete the string kill means retain the string b rsla restore display of string followed by da strid b tsnda turn teletype simulation on b tsfda turn teletype simulation off b long input mode puts the imlac into the mode where it sends coordinate information in a message with every character this is the normal operating mode for the imlac b short input mode puts the imlac into the mode where it outputs characters literally just like a teletype the imlac starts out in this mode when turned on a string of esc characters followed by a non esc indicates an emergency the imlac reinitializes itself and goes into short input and teletype simulation modes all other control characters are ignored messages sent from imlac to tenex short input mode every character typed on the keyboard is transmitted literally deutsch page rfc dec pdp imlac communication system july long input mode every message begins with esc and a count of subsequent characters codes b b represent keyboard input note that the imlac does not echo these characters on the display codes b b except esc represent typed in control characters the present implementation allows the user to generate all of these codes from the keyboard esc may be followed by a keyset mouse code or a control character code b represents an esc typed on the keyboard otherwise a code b b and a code b b follow this type of message is sent whenever the mouse buttons change or a character has been typed on the keyset and the imlac cannot convert this to an ordinary character the imlac converts recognizable keyset chords and mouse changes to characters see sri arc documentation for a full discussion of this hardware the codes b b represent accumulated keyset chords b means no complete chord has been struck the codes b b represent the state of the mouse buttons after a change a bit corresponds to a depressed button other codes should not appear all codes are followed by the inxy coordinates of the mouse this means or characters are sent for each character typed deutsch page rfc dec pdp imlac communication system july v division of responsibility the first criterion in design of the system just described was to allocate sufficient validity checking to the pdp to make it unnecessary for the imlac to send a response for each command thus the pdp allocates and checks display area identifiers and string numbers in the present implementation display areas are numbered system wide whereas strings are numbered from to n within a display area the only errors not detectable by the pdp are transmission parity errors and overflow of the imlac s memory the former are presently not corrected but could be handled by any standard technique the latter are in principle detectable by the pdp since the amount of space required to store a given display is fairly simply computable if the imlac runs out of space it deletes lines from the top of the teletype simulation display until only three are left before giving up a secondary criterion was to hold down the number of characters required to represent a display command we have found two problem areas and two areas in which we expect to expand the imlac s capability echoing was relegated to tenex since we desired to avoid the well known complications associated with remote echoing the question of identifying a device as an imlac to tenex gave us a great deal of trouble we settled on the convention of a tenex executive command which causes tenex to send the long input mode message the imlac starts out in short input mode the tenex character input routines also may be set into either long or short mode their state is changed by the tsnda and tsfda system calls deutsch page rfc dec pdp imlac communication system july in short mode tsnda last short input is passed literally and only the character is passed from long input in long mode tsfda last short input is padded with all zero coordinates and long input is passed literally this arrangement allows tenex programs which do not use the special features of the imlac to operate correctly with either an imlac or a teletype the user may restore the imlac to short mode with another command or with a special key on the imlac keyboard code is ready to allow the imlac to collect entire literal strings with some internal editing before sending them to tenex we have not resolved the disposition of characters typed by the user between the typed command initiating literal input and the receipt by the imlac of the collect literal message with k of core the imlac can handle a significant fraction of the command parsing and feedback functions of the sri arc on line system nls for which this effort is principally intended this rfc was put into machine readable form for entry into the online rfc archives by lorrie shiota deutsch page 