 network working group m krilanovich request for comments ucsb nic april network fortran subprograms preface the subroutines described in this document have been implemented at ucsb and make the network via the ncp accessible to fortran programs executing in the they are callable from within any fortran main program or subroutine compiled at ucsb krilanovich page rfc network fortran subprograms april a set of assembly language written subprograms is provided to facilitate the sue of the network by fortran programmers they serve as an interface between the user and the network control program ncp which supervises all network operations at this site a concept fundamental to fortran network operations is that of a completion code variable associated with each socket that is not in the closed state is a unique variable called a completion code variable this variable serves two purposes it identifies the local socket referenced and upon completion of the operation it contains a completion code to indicate the outcome of the operation to the programmer it may be used at any time for any purpose other than network operations its value at the beginning of a network operation is immaterial rather it is the variable itself that is important in all network operations whenever a completion code variable is called for the only acceptable type variable is interger in general the subprograms will initiate the operation and enter the wait state consume no cpu time until notified by the ncp of the completion of the operation for such operations the programmer supplies a time limit of type interger which specifies in tenths of a second the maximum length of time the subprogram is to wait for the operation to complete if this time limit is exceeded a completion code is supplied to indicate the error and control is returned to the calling program with the operation still pending in those operations requiring a socket to be specified by its socket identifier the following format is used the identifier is specified as a integer array with at least two elements or an element of such an array the first element specified is taken to be the site number and the next element the socket number a socket number may have any value positive negative or zero since negative numbers are represented internally in two s complement form for the purposes of the gender of a socket a socket number is even for odd according to whether its absolute value is even or odd respectively following is a description of each subprogram its function and calling sequence open by invoking this subprogram the user requests that the specified local socket be removed from the closed state and thus be prepared to participate in data transfer there are three distinct operations that can be performed by this subprogram and these are described below krilanovich page rfc network fortran subprograms april a connect by initiating this operation the user requests that the specified local socket be logically connected to the specified foreign socket and that data transfer between the two sockets be enabled the subprogram will wait until the foreign socket either accepts or rejects the connection attempt this operation is valid only when the local socket is in the closed state the calling sequence is as follows call open cmpcd time lclsck fgnsck ws where cmpcd is the completion code variable to be associated with the local socket time is the length of time the subprogram is to wait for the completion of the operation lclsck is the socket identifier of the local socket fgnsck is the socket identifier of the foreign socket ws is a workspace which as the same attributes as a socket identifier and if the operation is successful will become associated with the local socket for the life of the connection in response to certain future operations information may be returned to the programmer in this workspace the following completion codes are possible for this operation the operation was successful and the connection has been established the specified completion code variable is already assigned to a socket the operation was suppressed the specified local socket is not in the closed state the operation was suppressed all communication paths to the specified foreign site are in use the operation was suppressed krilanovich page rfc network fortran subprograms april local resources are insufficient to support another connection the operation was suppressed the connection attempt was rejected by the foreign process the specified local socket is not local to ucsb the operation was suppressed the specified foreign site is invalid the operation was suppressed an addressing or protection exception was encountered with respect to the specified workspace the operation was suppressed either hardware at the foreign site is inoperative or the ncp s counterpart at the foreign site does not exist or has failed local and foreign sockets are both either send or receive sockets the operation was suppressed by operator command all network operations were terminated the socket will be closed an ncp control transmission error occurred the operation was suppressed the specified time limit was exceeded the operation was initiated but not completed b listen this operation is a request for notification of any connection attempt directed toward the specified local socket the subprogram waits until such a call is received at which time the calling processes socket identifier is returned to the calling program this operation is valid only when the designated local socket is in the closed state the calling sequence is as follows call open cmpcd time lclsck ws where cmpcd is the completion code variable to be associated with the local socket krilanovich page rfc network fortran subprograms april time is the length of time the subprogram is to wait for the completion of the operation lclsck is the socket identifier of the local socket ws is a workspace which if the operation is successful will contain the socket identifier of the calling socket and will become associated with the local socket for the life of the connection ws has the same attributes as a socket identifier the following completion codes are possible for this operation the operation was successful and a call has been received the specified completion code variable is already assigned to a socket the operation was suppressed the specified local socket is not in the closed state the operation was suppressed local resources are insufficient to support another connection the operation was suppressed the specified local socket is not local to ucsb the operation was suppressed an addressing or protection exception was encountered with respect to the specified workspace the operation was suppressed by operator command all network operations were terminated the socket will be closed the specified time limit was exceeded the operation was initiated but not completed c accept this operation accepts connection with the foreign socket whose call caused successful completion of a previous listen operation by the specified local socket after completion of this operation data may be transferred to or from the local socket depending on its gender this operation is valid krilanovich page rfc network fortran subprograms april only when the last operation referencing the local socket was a listen operation the subprogram will wait until the operation is completed the calling sequence is as follows call open cmpcd time where cmpcd is the completion code variable associated with the local socket by a previous listen operation time is the length of time the subprogram is to wait for the completion of the operation the following completion codes are possible for this operation the operation was successful and the connection is established the specified local socket is in the closed state the ncp may have received an abort notification from the foreign process the operation was suppressed the previous operation specifying the designated local socket was not a listen the operation was suppressed all communication paths to the specified foreign site are in use the socket has been returned to the closed state the specified time limit was exceeded the operation was initiated but not completed close this operation is a request that the specified local socket be returned to the closed state if the last operation involving this socket was a listen this operation refuses the foreign process connection attempt if the last operation was connect the attempt is aborted if a connection is established any data in transit from the local socket is allowed to reach the foreign socket to be either received or flushed before the local socket is closed the subprogram will wait until the socket has been returned to the closed state krilanovich page rfc network fortran subprograms april the calling sequence is as follows call close cmpcd time where cmpcd is the completion code variable associated with the local socket time is the length of time the subprogram is to wait for the completion of the operation the following completion codes are possible for this operation the operation was successful and the socket has been returned to the closed state the specified completion code variable is not currently assigned to a socket the operation was suppressed the specified local socket is in the process of being closed the operation was suppressed but the local socket will be closed either hardware at the foreign site is inoperative or the ncp s counterpart at the foreign site does not exist or has failed krilanovich page rfc network fortran subprograms april by operator command all network operations were terminated the socket will be closed an ncp control transmission error occurred the operation was aborted a transmission error occurred the operation was aborted but the socket will be closed the specified time limit was exceeded the operation was initiated but not completed send this program causes data to be sent to the foreign socket the subprogram will wait until the data has been received by the foreign socket or until it has been queued locally by the ncp the calling sequence is as follows call write cmpcd bfr len time offset where cmpcd is the completion code variable associated with the local socket bfr is the data to be sent and can be of any type any length len is the number of bits of data to be sent if len is non positive no operation is performed len is of type integer time is the length of time the subprogram is to wait for the completion of the operation offset is the bit offset from the first bit of bfr at which data transmission is to begin and is of type integer if not specified offset defaults to zero the following completion codes are possible for this operation the operation was successful and the data has been sent the specified local socket is not a send socket the operation was suppressed krilanovich page rfc network fortran subprograms april the specified completion code variable is not assigned to a socket the operation was suppressed a previous send operation is in progress the operation was suppressed the connection is not fully open the operation was suppressed the foreign socket terminated the connection before completion of the send operation not all the data was transmitted either hardware at the foreign site is inoperative or the ncp s counterpart at the foreign site does not exist or has failed by operator command all network operations were terminated the socket will be closed one or more interrupts were received from the foreign socket the operation was suppressed an addressing exception was encountered with respect to the data buffer the operation was suppressed an ncp control transmission error occurred the operation was aborted and the socket will be closed a transmission error occurred the operation was aborted and the socket will be closed the specified time limit was exceeded the operation was initiated but not completed receive this operation causes data to be received from the foreign socket the subprogram will wait until the reception of data is complete the calling sequence is as follows call read cmpcd bfr len time offset krilanovich page rfc network fortran subprograms april where cmpcd is the completion code variable associated with the local socket bfr is the variable into which the data is to be placed and can be of any type any length len is the number of bits of data to be received if len is non positive no operation is performed len is of type integer time is the length of time the subprogram is to wait for the completion of the operation offset is the bit offset from the first bit of bfr at which the first bit of data is to be placed and is of type integer if not specified the offset defaults to zero the following completion codes are possible for this operation the operation was successful and the data has been received the specified local socket is not a receive socket the operation was suppressed the specified completion code variable is not assigned to a socket the operation was suppressed a previous receive operation is in process the operation was suppressed the connection is not fully open the operation was suppressed the foreign socket terminated the connection before completion of the receive operation data is unpredictable an addressing or protection exception was encountered with respect to the data buffer the operation was suppressed either hardware at the foreign site is inoperative or the ncp s counterpart at the foreign site does not exist or has failed krilanovich page rfc network fortran subprograms april by operator command all network operations were terminated the socket will be closed one or more interrupts were received from the foreign socket the operation was suppressed an ncp control transmission error occurred the operation was suppressed and the socket will be closed the specified time limit was exceeded the operation was initiated but not completed check this operation causes the status of the specified local socket to be returned there is no completion code variable associated with this operation since it is always successful and the socket is identified by its socket number this operation is valid at any time and is always completed immediately the calling sequence is as follows call check lclsck stat menu fgnsck deficit where lclsck is the socket identifier of the local socket stat is a code for the status and is of type integer mnem is a mnemonic for the status and can be of any type of any length greater than or equal to eight bytes fgnsck is the socket identifier of the foreign socket or zero deficit is the send receive deficit in bits or zero and is to type integer lclsck is the only argument the programmer need define the others are output from the subprogram krilanovich page rfc network fortran subprograms april stat mnem meaning open a connection is fully established no send receive operation is in progress fgnsck is the socket identifier of the connected socket deficit is the number of bites queued locally at the socket by the ncp and available to satisfy a future receive operation or awaiting output ads the results of a previous send operation listen a listen has been issued connect a connect has been issued fgnsck is the socket identifier of the foreign socket decision a listen has been completed fgnsck is the socket identifier of the calling socket call s one or more calls have been received for the local socket no listen or connect has been issued i o a connection is fully established a send receive operation is in progress fgnsck is the socket identifier of the connected socket deficit is the number of bits yet to be sent or received closed the socket is in the closed state drain the foreign socket is attempting to close the connection the ncp has data yet to be ready by the local socket fgnsck is the socket identifier of the connected socket deficit is the number of bits yet to be received drained the foreign socket is attempting to close the connection the ncp is awaiting arrival at the foreign site of data currently in transit fgnsck is the socket identifier of the connected socket closing the local socket has issued a close the ncp is in the process of returning the local socket to the closed state fgnsck is the socket identifier of the connected socket krilanovich page rfc network fortran subprograms april drain the local socket has issued a close the ncp is completing the last send operation before returning the local socket to the closed state fgnsck is the socket identifier of the connected socket deficit is the number of bits the ncp has yet to transmit identify this operation is used to identify a local socket by its completion code variable the operation is valid at any time and is always completed immediately since it is always successful there are no completion codes for the operation and the contents of the completion code variable are not changed the calling sequence is as follows call id cmpcd lclsck where cmpcd is the completion code variable associated with the local socket lclsck is set to the socket identifier of the local socket if the completion code variable is associated with a socket or to zero otherwise signal this operation is used to convey a signal to the foreign process the significance of the signal is completely user dependent the effect is that the next time the foreign socket attempts to initiate a receive or send operation the operation will be suppressed and a completion code supplied indicating that a signal had been received the subprogram will wait until the signal has been sent to the foreign ncp this operation is valid only when the socket is fully open the calling sequence is as follows call signal cmpcd time where cmpcd is the completion code variable associated with the local socket time is the length of time the subprogram is to wait for completion of the operation krilanovich page rfc network fortran subprograms april the following completion codes are possible for this operation the operation was successful and the signal has been sent the specified completion code variable is not assigned to a socket the operation was suppressed the connection is not fully open the operation was suppressed certain of the network subprograms are intended for although not restricted to use with the online system network operators the following is a general description of these operators in all network operations involving the online system network operators there are certain conventions concerning the format of the data sent and received the data is grouped in messages consisting of three fields op code length and text in that order the op code is one byte in length and is a code which indicates how the text field is to be interpreted the length field is two bytes long and gives the length in bits of the text fields which contains the actual data the op code and length fields together are termed a header krilanovich page rfc network fortran subprograms april the following op codes are presently defined op code meaning this op code is a nop no text field exists and the contents of the length field are unpredictable this op code is used mainly as a delimiter the text field contains ebcdic characters one character per byte the online system operators consider the characters as intended for display as soon as the text field has been received the text contains codes for keypushes one byte per key the online operators consider the keys as intended for execution as soon as the text field has been received the same as for an op code of except that the online operators consider that the execution of the keys will be delayed until all data for that receive operations has been received the standard format of data sent or received by the online system operators is a string of messages with the last message indicated by a header with a nop op code called a trailer these conventions are the default situation any of them may be overridden by appropriate programming following are descriptions of those subprograms intended for use the online system operators write to online console this subprogram causes data assumed to be characters represented by their ebcdic codes to be sent from the specified local socket the characters are sent in a standard message preceded by a header and optionally followed by a trailer the subprogram waits for the data to be received by the foreign socket or to be queued locally by the ncp this operation is valid only when the local socket is a send socket and is fully open krilanovich page rfc network fortran subprograms april the calling sequence is as follows call wtolc cmpcd bfr len level across down time where cmpcd is the completion code variable associated with the local socket bfr is the character string to be sent and can be of any type any length len in absolute value is the number of characters to be sent if len is positive or zero the end of the data is indicated by a trailer if len is negative no trailer is sent len is of type integer level indicates the mode of typing the absolute value of level if non zero is the shift level on which to type and must be less than or equal to nine if greater than nine one is sued if level is positive across and down are relative to the current typing location if level is negative the carriage is positioned to the upper left hand corner before typing begins thus making across and down absolute coordinates if level is zero the tying is in case one characters and a carriage return precedes the positioning for across and sown if the characters to be displayed are case one characters the header sent will have an op code which indicates characters to be displayed as soon as they are received otherwise the op code will indicate buttons to be executed as soon as received level is of type integer across is the number of spaces to be moved horizontally across the display tube before beginning to type across can have any value positive negative or zero and is type integer time is the length of time the subprogram is to wait for completion of the operation the completion codes for this operation are the same as for send krilanovich page rfc network fortran subprograms april read from online console this subprogram receives data assumed to be characters represented by their ebcdic codes from the foreign socket in one or more standard messages the subprogram will wait for the data optionally followed by a trailer to be received by the local socket this operation is valid only when the local socket is a receive socket and is fully open the calling sequence is as follows call rfolc cmpcd bfr len time where cmpcd is the completion code variable associated with the local socket bfr is the variable into which the data is to be placed and can be of any type any length len in absolute value is the maximum number of characters to be placed in bfr if the length fields of the head s received total more data than len the excess data will be received but will not placed into brf and will not be accessible to the program if len is positive or zero data will be received until a trailer is encountered if len is negative a single message exclusive of trailer will be received len is of type integer time is the length of time the subprogram is to wait for completion of the operation the completion codes for this operation are the same as for receive write to online console with reply this subprogram combines the functions of write to online console and read from online console the subprogram first sends a string of data to the foreign socket form the specified send socket waits for it to be received by the foreign socket or queued locally by the ncp and then waits for a reply directed toward the specified receive socket the operation is valid only when the sockets have the correct gender and both are fully open krilanovich page rfc network fortran subprograms april the calling sequence is as follows call wtolcr cmpcd bfr len level across down time cmpcd bfr len where cmpcd is the completion code variable associated with the local send socket bfr is as in write to online console len is as in write to online console level is an in write to online console across as in write to online console down is as in write to online console time is the length of time the subprogram is to wait for completion individually of the transmission and reception of data cmpcd is the completion code variable associated with the local receive socket brf is as bfr in read from online console len is as len in read from online console the completion codes for the send socket are the same as for the send operation and the completion codes for the receive socket are the same as for the receive operation erase this subprogram cause data constituting on online system command to erase the display tube to be sent from the specified local socket the data is sent in a single standard message including an op code indicating characters to be displayed as they are received and optionally including a trailer the subprogram waits for the data to be received by the foreign socket or to be queued locally by the ncp this operation is valid only when the local socket is a send socket and is fully open the calling sequence is as follows krilanovich page rfc network fortran subprograms april call erase cmpcd delay delay time where cmpcd is the completion code variable associated with the local socket delay in absolute value is the length of time in tenths of a second the subprogram is to pause in the wait state before sending the erase if delay is positive or zero a trailer will be sent after the erase if negative no trailer will be sent delay is of type integer delay is the length of time in tenths of a second the subprogram is to pause after sending the erase and before returning control to the calling program and is of type integer time is the length of time the subprogram is to wait for completion of the operation the completion codes for this operation are the same as for send krilanovich page 