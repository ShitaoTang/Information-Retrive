 a network protocol concept network working group douglas b mckay request for comments donald p karp nic ibm thomas j watson research center categories c c c c d yorktown heights new york update none obsoletes none this rfc is being circulated as an information rfc its intent is to convey some of the thinking and philosophy that went into ibm s network protocol and overall network design page introduction network o is an experimental project in computer netting that was undertaken by the computer science department of ibm research the primary objectives of the project have been to understand netting identify design problems and implement the solutions to these problems the above objectives have been met since a network has been built and is presently being operated by the project implementation discussions transpired with another department at research in order to define a realistic user system interface the protocol defined for the project s network is also the basis for the operation of an ibm os network the network o project has also been involved in the philosophical and architectural concepts of network systems the basic premise in our work is the concept of a logical network machine the main theme is to treat all systems involved in the network as a part of a single large multiprocessor system although many of the ideas have been based on hypothetical concepts an equal number of ideas were derived from our network implementation and operating experience the scope of this paper is to describe the philosophy and definition of a network protocol that is not restricted to any physical configuration this is exemploified by the fact that a major portion of the ideas are implemented in ibm s two major operational networks one of which is a distributed configuration and the other a star configuration intenet report february computer science department ibm corporation t j watson research center yorktown heights new york basic assumptions there was a necessity to delineate many network functions in setting up an operating protocol these functions included switching control buffer control message control and operating control the operating control function becomes further complicated as the user is able to program the network as if it were a single operating system the protocol had to be further broken dowm into detailed functions in order to cope with error recovery and handling techniques the original thoughts on handling these functions were to provide two basic realms of control the net control is a higher level function that recognizes and controls all aspects of net jobs and the execution of job steps in the network machine in addition a communication control facility referred to as an express interpreter was incorporated to provide fast service for all messages that were to be moved between user systems without intervention by the net controller page nc in out express exchange out in the above figure illustrates the two major functions with messages travelling in both directions and directly through the express exchange except in the case of messages that must be acted on by the net controller these messages will be explained in detail later these two functions can exist on any system and operate in any physical configuration providing the control information reflects the configuration so that proper operation can be maintained there is no reference to physical configuration in this paper because of the flexible nature of the protocol and its adaptability to any configuration for example in the case of a distributed net the express exchange would pass messages directly to the next station without any nc overhead the nc would only come into play at the final destination and with the same reasoning the nc would not have to be present at every station definitions before proceeding with the discussion of protocol and control the basic message content and concepts must be defined a transmission block is a physical entity that consists of header and text a message logical consists of many transmission blocks header text the primary purpose of the network is to deliver messages from one user system to another in an orderly controlled manner in order to provide all the information necessary to maintain control the header contains a set of operational functions these functions are listed below with the rationale for each page action code this code selects the immediate destination of the transmitted blocks the data may be transmitted directly to the user described in the dsid field sent to nc or used by ee any conflict in information between this field and any other field in the header will cause an error message to be returned to the originating station the ac will serve a similar function at the receiving system indicating to the communications interface ci whether the data block is destined for a user routine or contains control information for the ci the ci is that function which interfaces directly with the local operating system transmission block number each block of transmission within the network will contain a sequential number inserted by the transmitting station as the block flows through the network every station will insert its own number into the block overlaying the previous station s number the purpose of this sequential number is to guarantee that no messages are lost in the physical communications process network job identifier the function of this field is to associate a transmission block with the network job to which it belongs the identifier is assigned to the network job and to each associated transmission block by the user system or by the nc in order to establish a unique name for each job within the network the user node identifier i e the name of the user system originating the net job will be concatenated with a number generated by the originating user system job step marker the purpose here is to uniquely identify a job step within a network job the nc will assign this name since it maintains control of all network jobs originating system identifier in order to route a block of data from one user system to another a unique name must be associated with each user system the name will be assigned by the network control group at the time the user system is accepted as a network participant the station originating a block of data will place his assigned identification in this field in every block of data originating at his system page message priority this field indicates transmission priority not to be confused with processing priority by block within the queue for a particular user system destination system identifier this is similar to the originating node identifier except that the identification inserted is that of the node for which the block is destined logical message flags the message flags denote the first and last blocks of a message all intermediate blocks are noted by their absence the flag field in conjunction with the logical message sequence number will enable the user to determine if any blocks are missing from a message and will also provide an identifier that can be used to recover missing blocks when the first and last indicators are turned on in a single block the message is contained within the block logical message sequence number this field is used to number sequentially the blocks within a message the first block denoted by the lmid will contain the lowest number assigned not necessarily within a message while the last block will contain the highest number unlike the tbn this number will remain intact throughout the journey of the block through the network it is used for error detection and recovery along with the logical message flag logical message identifier since all communications lines in the network can be multiplexed blocks within a message will be interleaved with blocks from other messages a message identifier becomes necessary in order to reassemble the message at the user destination therefore each block within a message will contain an identifier unique to the message in the simple case where the message is contained in one block the identifier performs no function when multiple blocks comprise a message lmid will enable the user to reassemble the message there can be any number of physical message blocks associated with any logical message it is important that the that this lmid be used in the messages generated by the ci in response to nc commands page length of text this field contains a binary number that equals the number of characters in the text portion of the transmission block although there are other means available to obtain this number it is included in the header for redundancy check purposes logical message structuring the network controller maintains control for every user job submitted by njid the following hierarchical structure is set up for a message configuration any message pertaining to any step in a network job can be tracked and retransmitted if necessary it provides a mapping of the logical structure of any network job into their appropriate message configuration net controller njid njid njid n stepname stepname lmid lmid lmid n lmsn lmsn lmsn n the express exchange is a combination of functions it is basically a communication handler and store and forward switch the ee has the ability to keep track of all messages in the network by ten defined earlier it is therefore possible to record and reflect the entire status of the network down to any detail desired protocol the protocol for operating a network system has different levels of control the ee must exercise control on the communication link between any pair of stations the nc maintains control at the net job level however the functions that each unit performs are combined to handle special control cases these complimentary functions will be discussed in detail as they arise in the protocol discussion page first of all there must be a series of initialization messages sent from one station to another before any actual message transmission takes place these messages are sent between each station and positive acknowledgments must be received in order to complete the initial hand shaking at any point during the transmission of messages an error can occur which will be detected by a negative acknowledgement the message in error will be retransmitted several times if the error persists the line is timed out and will be retried later the assumption here is the line may be temporarily noisy and we give it time to quiesce when a station receives an initialization message it is possible to respond in several ways depending on the status of the user system the station receiving the initialization message can acknowledge that it is ready to receive and transmit temporarily cannot receive certain logical messages actual data transmissions but can receive special control messages this option allows a user system to selectively process net jobs as facilities on his system become available unable to receive traffic in other words the user system is logically or physically disconnected from the network unable to receive new network job requests but able to handle traffic for jobs in progress the user system may have several jobs in progress that are transmitting and receiving messages this acknowledgement gives the user system the ability to allow these jobs to continue normal processing the last alternative gives the ci at each user system the mechanism to selectively demultiplex itself to handling one logical message the temporarily deactivated thus all user systems can selectively halt messages throughout the entire network the destination system can selectively halt all messages for a given njid or selective halt logical messages within a net job the adjacent system would keep accepting messages until its buffers were filled to some operational threshold limit that must be maintained to keep the network from coming to a complete standstill and would issue selective halts to systems sending to it it is conceivable that the message blocks of one logical message would be stored in distributed segments throughout the network the same selective halt mechanism can be applied in reverse through a resume message the resume message can apply to an entire set of messages for a net job or selective logical messages within a job the reinitiation of a transmission takes place between any two stations that wish to allow more message blocks to be transmitted the destination page station must resume on a particular logical message to allow the message to reach its final destination and complete transmission through the network the lmid of the message header enables the ee and nc to cooperate in controlling and cleaning up network operation not only does this cooperation between logical levels reduce a duplication of effort but it enables the control to become realistic and practical complete separation of communications and control functions could cause a loss of useful information that may not be obtained by other means for example if a file transmission consisted of many blocks and a transmission error occurred that the network was unable to recover the ee would notify the nc of the error occurrence on this file transmission and then nc would issue purge messages to the ee s for those particular logic message blocks this mechanism allows a general clean up and management of all file transmissions there is also the condition when a receiving system goes down when this occurs there may be a number of network jobs involved with that user system if the user system remains down for an extended period of time and the ee buffer resources are filled to threshold limit it may be necessary to purge pending message blocks the ee will notify the nc of the user system being down and the nc will issue purge commands to the ee for all pending messages of those netjobs involved with the down user system however in our present implementation the ee uses disk storage as a logical extension of core for message buffering in this operation the freeing of real core buffers becomes a simple matter of moving the messages on to disk for later retrieval in some instances of transmission a file may be scored in segments at several locations until the receiving system is able to receive it network buffer resources are treated as a logically simple entity that may be physically distributed when the user system comes back on the air the involved user network job will be restarted by issuing resume transmit commands to the ee if the user is an interactive user controlling the network he would be notifed of the problem and status of his file transmission he could then reinstate his command at a later time the batch network jab would be restarted at a point where no unnecessary retransmission would occur it has not been determined how long files should reside in a store and forward node before being purged from the network if a backing storage device is available to network operation the file can remain for a longer time but still not indefinitely page nc protocol the file transmission protocol of the nc is primarily concerned with the control and transfer of user files for storage temporary use at a remote system and execution the commands and status messages that pertain to the second level logic of the nc are sent and interpreted by the sending and receiving systems all initiation of file transfers result from direct user commands to the nc the sending system will first be interrogated to determine if the file is resident at that system the user must provide the necessary information to locate the file if it is not catalogued at that system this information consists of the physical attributes such as volume and serial number a negative acknowledgement to this message would result in the termination of a net job step with the reason for termination returned to the originator when a positive acknowledgement is received by the nc it has two options available it must first determine the amount of unused buffer space in the ee and based on the size of the file to be transferred decide whether to have the data set sent immediately or wait for an acknowledgement to the receive message if the nc decides to move the file regardless of the state of the receiving system the nc will issue a send or receive message to both systems simultaneously a negative response to the receive message is taken as a definite refusal by the receiving system to accept the data transmission this may result from insufficient resources to handle the job if the file was transmitted from the receiving system and is resident in the network storage facilities the user will be notified of its exact location so that he may move it from that point at a later time if the nc chose the second option the file would still be resident at the originating system a positive acknowledgement will allow the file to continue its normal flow through the network queuing in the ee is always done in order that receive messages will be sent before the actual data files the possibilities include loading the file directly into the job stream this step assumes the appropriate jcl is included in the text of the files or cataloguing the file at the remote system or storing it for temporary immediate use all network files are catalogues with a unique name that includes user id unique at his home node home node id unique in the network and his own data name which is unique in his own work the receive message may also contain some special instructions to print or punch a file page when the sending and receiving stations have completed the file transfer they send status messages back to the nc indicating the completed action these status messages enable the nc to keep a record of user network job steps and their progress through the network these status messages play an important part in insuring proper checkpoint restart for the network files routed specifically for execution require a third status message from the receiving user system the system must indicate when and how the job completed execution this status message will also contain the appropriate accounting information to allow dynamic updating of network user and system accounting information it is not clear at this time what should be accounted for in the network but it is an area of prime concern to operational networks an error in the second logic level can occur during the file transmission there may be an error moving files from devices into the line buffers or reading from the line buffers when this occurs the operating system must pass this information to the nc the nc will then terminate the task involved in this job step and purge all the network buffers containing blocks of this message transmission when the nc receives the file error message it will immediately send a release message to all the network tasks supporting this job step this action will cause the user systems to end all pending tasks associated with this net job step in addition a purge message for that job step will be sent to the ee to purge the message from its buffers if there is more than one ee involved the purge message would be passed to all other ee s this is another example of the ee and nc combining functional capability and providing effective management of network traffic the mapping of message into the job step allows the nc to selectively choose all messages it wishes to purge the protocol the user must use for interactive use of the network is different there are some standard message types that are provided for interactive use to insure the proper message recognition from one system to another terminal type traffic will be sent across the network through the normal netting interface the control information that a terminal sends to the operating system must be incorporated in the network protocol by the ci the interactive user can request a direct connection to the remote system through the nc the nc will notify the remote system of the user request and establish the user s direct link the nc becomes a monitor of the conversation but no longer becomes involved with the messages other conversational messages are sent back and forth through page the ee with no interaction by the nc in the event one of the systems goes down breaking the logical link the nc must notify the other system to terminate the waiting task in most cases a user system will be isolated from the second user system by other stations and the nc is a convenient way of notifying other user systems about the disaster once the user s connection is established three types of messages may be generated these messages are identified by the ac field in the header the three basic transmission types covered by the protocol are a response requested with or without text included in the message a text message which is simply a response to the first or just data to be printed at the user s terminal and finally an interrupt message which indicates the user wishes to stop a task or talk directly to the operating system it is important to note that regardless of what type of conditions exist there are always enough buffers left to receive an interrupt message and terminate or flush any existing task and the associated operation it may be supporting conclusion the protocol concepts discussed in this paper were developed to facilitate the transfer of data between two or more independent systems the protocol is able to handle the various pathological cases that may arise during network operation a fundamental design consideration in developing these concepts was to maintain complete recovery from any recoverable error condition many of the concepts have been used in an operational star network with a single ee and nc located in the central system and a ci located at each participating system the successful operation of the network has proven the feasibility of this protocol acknowledgment the authors wish to acknowledge the design and implementation effort of the contributing members of the computer science department of the t j watson research center this rfc was put into machine readable form for entry into the online rfc archives by tim buck page 