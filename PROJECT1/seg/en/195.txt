 network working group a mckenzie request for comment bbn nic december category d reference rfc a suggested addition to file transfer protocol on november an informal meeting was held at ucla to discuss prospects for a network standard remote job service rjs protocol in attendance were representatives of ucla ccn and ucsb the network s only current rjs sites as well as ucla nmc and the bbn network project a report on that discussion will be published as an rfc shortly and will not be discussed here in thinking about the use of the proposed file transfer protocol ftp rfc for rjs however we came to the conclusion that a restart procedure might be an extremely useful addition to the ftp many perhaps most of the individuals involved in protocol design thus far are oriented toward the use of short date transmissions over the network the transmission lengths that have been considered typical are a few characters a print line or perhaps as much as a page of text the experience of the current rjs sites however is that single files are commonly much longer for example a line printer output file of pages would not seem unusual to these sites further one might reasonably predict that network use of remote job services will be preselected with a tendency toward large jobs although large jobs do not necessarily imply large i o files and that the addition of other batch service sites illiac ucsd will increase the number of long file transfers in light of this kind of experience prediction it would seem that the ftp should include perhaps as an option which interactive user oriented systems could ignore a method of restarting a long file transfer if some element in the transmission path fails after a large volume of data has been transferred the critical element in a restart procedure is the ability to arrange agreement between both ends of the transmission path as to where exactly the retransmission should begin there are two potential candidates for marking possible restart locations already built into the proposed data transfer protocol rfc which underlies the ftp these are a the information separators transaction type b which are available in both transparent block transfers and descriptor and counts transfers and mckenzie page rfc a suggested addition to file transfer protocoldecember b the sequence numbers which can be used with the descriptor and counts transfer mode mckenzie page rfc a suggested addition to file transfer protocoldecember after some discussion we seemed to agree that the information separators as they would be used in transparent block transfer mode i e without sequence numbers were unlikely to serve as unambiguous restart location marker and therefore we suggest the use of sequence numbers as markers we were aware of the fact that this choice might exclude tips and other hosts which do not use sequence numbering from the type of recovery under discussion we believe however that our suggestion eliminates at least some of this problem imagine that some site which we will call the user site or user has initiated a connection from its own file transfer process to a file transfer process at some other site which we will call the server site or server after the appropriate exchanges of information a file transfer using the file transfer protocol begins over the path between these two sites after some information is transferred the path between the user and server is broken at some later time the user initiates a new connection between the file transfer processes at user and server establishes relevant access privileges and wishes to resume the transmission which was in progress when the path was broken first we describe four new op codes for the file transfer protocol hex operation append at sequence number this command is essentially the same as any of the store or append commands except that a bit sequence number immediately follows the op code before the pathname retrieve at sequence number this is the same as the retrieve command except that a bit sequence number immediately follows the op code before the pathname resume retrieve to be used when the user wishes the server to choose the sequence number in other respects this is identical to the retrieve command mckenzie page rfc a suggested addition to file transfer protocoldecember use the sequence number this command contains only the op code and a bit sequence number it is intended as a denial of the ability to locate the sequence number given in an append at sequence number or retrieve at sequence number command and simultaneously to suggest another number which can be located there are several possible cases which are shown below the user site is always presumed to be the site at the left of the page mckenzie page rfc a suggested addition to file transfer protocoldecember a user site sending at time path is broken append at sequence number acknowledge data the server site agrees to resume at the user chosen point the first data transaction is numbered with the chosen sequence number append at sequence number unsuccessful terminate the server site will never permit restart for some reason seq s were ignored or not used initially seq s were not stored with the file the file was lost when the path was broken etc append at sequence number use this sequence number data the user site agrees to use the server chosen number and the first data transaction is numbered with the chosen number or unsuccessful terminate the user site cannot restart at this number for some reason mckenzie page rfc a suggested addition to file transfer protocoldecember b user site receiving at time path is broken and the user site does not particularly care about the exact sequence number for example if the user site is sending the file to a printer some duplicate pages are probably acceptable and the user site would probably not want to remember sequence numbers resume retrieve data the server picks some point and begins transmission at that point if sequence numbers were used during the original transmission then the first transaction of this transmission must exactly match including sequence number some transaction of the original transmission resume retrieve unsuccessful terminate the server site is unable or unwilling to restart the transmission mckenzie page rfc a suggested addition to file transfer protocoldecember c user site receiving at time path is broken and does care about the value of the sequence number retrieve at sequence number data the server agrees to resume at the user chosen point the first data transaction is numbered with the chosen sequence number retrieve at sequence number unsuccessful terminate the server site will never permit restart for some reason retrieve at sequence number use this sequence number acknowledge data the user site agrees to use the server chosen number the first data transaction is numbered with the chosen number or unsuccessful terminate the server cannot use the user chosen number and the user cannot use the server chosen number therefore the attempt to restart must be abandoned mckenzie page rfc a suggested addition to file transfer protocoldecember some sites e g ucla ccn have agreed in principle at least to implement these commands and more important to store sequence numbers with files being transferred on a non volatile storage medium so that restarts may be effected this will be done of course only if this or some similar proposal is accepted by the nwg as part of the file transfer protocol we hope interested parties will communicate comments or counter proposals to the ftp committee and or publish their ideas in the rfc series aam jm this rfc was put into machine readable form for entry into the online rfc archives by kelly tardif viaginie mckenzie page 